# Configuração do Modelo de Otimização de Mix Diário
# Data: 2024-12-08
# Versão: 1.0

# ==============================================================================
# CAMINHOS DOS ARQUIVOS
# ==============================================================================
paths:
  # Arquivos de entrada (relativos à raiz do projeto)
  estoque: "../manti_estoque.parquet"
  classes: "../base_skus_classes.xlsx"  # Classificacao de SKUs por classe
  pedidos: "inputs/pedidos_clientes.csv"  # Pedidos de clientes (pode ser parcial)
  compatibilidade: "inputs/compatibilidade_sku_embalagem.csv"  # Histórico
  # compatibilidade_tecnica: "inputs/compatibilidade_tecnica_sku_embalagem.csv"  # Técnica (opcional)
  precos: "inputs/precos_sku_embalagem.csv"
  custos: "../CUSTO ITEM.csv"
  faturamento: "../manti_fat_2024.parquet"  # Faturamento historico para calcular demanda
  # custo_embalagem: "inputs/custo_embalagem.csv"  # Opcional
  
  # Arquivos de saída
  output_dir: "resultados"
  logs_dir: "logs"

# ==============================================================================
# PARÂMETROS DO SOLVER (OR-Tools)
# ==============================================================================
solver:
  # Tipo de solver
  solver_type: "SCIP_MIXED_INTEGER_PROGRAMMING"  # OR-Tools padrão
  
  # Limites de tempo e gap
  time_limit_seconds: 600  # 10 minutos (ajustar conforme necessário)
  time_limit_ms: 600000    # 10 minutos em milissegundos
  gap_percentage: 0.01     # 1% de gap de otimalidade
  
  # Paralelização
  num_threads: 4           # Usar 4 threads (ajustar conforme CPU)
  
  # Logging
  verbose: true            # Mostrar progresso do solver
  
  # Tolerâncias numéricas
  primal_tolerance: 1.0e-7
  dual_tolerance: 1.0e-7

# ==============================================================================
# PARÂMETROS DE PREPARAÇÃO DE DADOS
# ==============================================================================
dados:
  # Data do estoque a considerar
  data_estoque: "2025-08-19"  # Data com maior estoque (71.873 unidades)
  
  # Tipo de estoque
  tipo_estoque: "DISPONIVEL PARA VENDA"  # Ajustar conforme necessário
  
  # Filtros de qualidade de dados
  sku_minimo_transacoes: 1      # Mínimo de transações para considerar SKU
  
  # Tratamento de outliers
  remover_outliers_preco: true
  percentil_inferior_preco: 1   # Remover 1% menores preços
  percentil_superior_preco: 99  # Remover 1% maiores preços

# ==============================================================================
# PARÂMETROS DE NEGÓCIO
# ==============================================================================
negocio:
  # Margem mínima
  margem_minima_percentual: 0.0 # 0% = aceita qualquer margem positiva
  filtrar_skus_margem_negativa: true  # Remover SKUs com margem negativa

# ==============================================================================
# PARÂMETROS DO MODELO
# ==============================================================================
modelo:
  # Tipo de variáveis
  variaveis_continuas: true     # true = LP relaxado, false = MILP puro
  
  # Objetivo
  maximizar_margem_absoluta: true      # true = R$, false = %
  
  # Restrições opcionais
  escoar_todo_estoque: false   # Se true, força escoar pelo menos 95% do estoque
  
  # Realocação entre SKUs da mesma classe
  limite_realocacao: 2.0  # SKU pode receber até 2x seu estoque original (1.0 = sem realocação)
  
  # Controle de volume para otimização
  # IMPORTANTE: 
  # - Se atender_pedidos=true, SEMPRE usa excedente (estoque - pedidos), independente desta flag
  # - Se atender_pedidos=false, esta flag controla se usa excedente ou estoque total
  # - Se atender_pedidos=false E usar_apenas_excedente=true, sera ajustado automaticamente para false
  usar_apenas_excedente: false  # So faz diferenca quando atender_pedidos=false
  atender_pedidos: false  # true = atende pedidos com prioridade, false = ignora pedidos completamente
  
  # Restrições de demanda histórica
  considerar_demanda_historica: true  # true = limita alocacao baseada em demanda historica
  granularidade_demanda: M  # Granularidade da agregacao: M=Mensal, S=Semanal, D=Diaria
  tipo_calculo_demanda: percentil  # Tipo de calculo: "percentil" ou "maximo"
  percentil_demanda: 95  # Percentil da demanda historica (50=mediana, 75=percentil 75, 90=percentil 90) - usado apenas se tipo_calculo_demanda=percentil
  fator_expansao_demanda: 5  # Multiplicador sobre o percentil (1.0=sem expansao, 1.5=50% acima, 2.0=dobro, 5.0=5x) - usado apenas se tipo_calculo_demanda=percentil
  fator_percentual_maximo: 1.2  # Fator percentual sobre o maximo historico (1.0=igual ao maximo, 1.2=20% acima, 1.5=50% acima) - usado apenas se tipo_calculo_demanda=maximo
  periodo_historico_meses: 12  # Quantos meses usar para calcular demanda historica

# ==============================================================================
# PARÂMETROS DE ANÁLISE DE RESULTADOS
# ==============================================================================
analise:
  # Top N
  top_n_combinations: 20       # Top 20 combinações por margem
  
  # Agrupamentos para análise
  agrupar_por_embalagem: true
  agrupar_por_sku: true

# ==============================================================================
# MODO DEBUG
# ==============================================================================
debug:
  ativar: false                        # Ativar modo debug
  salvar_modelo_mps: false             # Exportar modelo em formato MPS
  salvar_modelo_lp: false               # Exportar modelo em formato LP
  limitar_skus: null                    # null ou número (ex: 50 para testar)
  seed_random: 42                      # Seed para reprodutibilidade

# ==============================================================================
# VERSIONAMENTO
# ==============================================================================
meta:
  versao_modelo: "1.0"
  data_criacao: "2024-12-08"
  autor: "7D"
  descricao: "Modelo de otimização de mix diário (SKU x Embalagem) sem clientes"
  changelog:
    - "2024-12-08: Versão inicial - mix diário sem clientes"

